var common = require('../../lib-cov/common');
var nock = require('nock');
var OIO_URL = 'https://api.orchestrate.io';
var use = require('../../lib-cov/commands/use');
var assert = require('assert');

describe('use', function () {
  before(function () {
    this.original_config = common.get_config();
    common.put_config({
      keys: { jellykid: 'exists' }
    });
  });

  after(function () {
    common.put_config(this.original_config);
  });

  afterEach(function () {
    nock.cleanAll();
  });

  it('should save a valid key', function (done) {
    var scope = nock(OIO_URL)
    .head('/v0')
    .reply(200);

    use('afjhalwkjehfalhe', {})
    .then(function () {
      done();
    })
    .fail(done);
  });

  it('should save a valid key with an alias', function (done) {
    var scope = nock(OIO_URL)
    .head('/v0')
    .reply(200);

    use('afjhalwkjehfalhe', 'jellykid', {})
    .then(function () {
      done();
    })
    .fail(done);
  });

  it('should not save invalid keys', function (done) {
    var scope = nock(OIO_URL)
    .head('/v0')
    .reply(401);

    use('afjhalwkjehfalhe', {})
    .fail(function () {
      done();
    });
  });
});
