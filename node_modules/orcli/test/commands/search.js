var search = require('../../lib/commands/search');
var nock = require('nock');
var OIO_URL = 'https://api.orchestrate.io';
var assert = require('assert');

describe('search', function () {
  afterEach(function () {
    nock.cleanAll();
  });

  it('should perform a query', function (done) {
    var scope = nock(OIO_URL)
    .get('/v0/users?query=name%3ADiana*%20username%3Agar*')
    .reply(200);

    search(['users', 'name:Diana* username:gar*'], {})
    .then(function () {
      assert(scope.isDone());
      done();
    })
    .fail(done);
  });
});
