var common = require('../common');
var orchestrate = require('orchestrate');
var kew = require('kew');

var USAGE = "orcli patch [collection] [key] (op) (path) (value)";

module.exports = function (args, ops) {
  var db = common.get_db(this.api_key);

  if (args.length < 2) throw new Error(USAGE);

  var collection = args[0];
  var key = args[1];

  var builder = db.newPatchBuilder(collection, key);

  if (ops.length) {
    // if it's an array, apply them in series;
    ops.forEach(function (op) {
      builder = builder[op.op](op.path, op.value || op.from);
    });
    return builder.apply();
  } else {
    if (args.length < 5) throw new Error(USAGE);
    
    var op = args[2];
    var path = args[3];
    var value = args[4];
    return builder[op](path, value).apply();
  }
};
