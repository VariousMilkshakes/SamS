// common functions

var fs = require('fs');
var ini = require('ini');
var path = require('path');
var osenv = require('osenv');
var orchestrate = require('orchestrate');
var CONFIG_PATH = path.join(osenv.home(), '.orcli');

function get_db (key) {
  if (key) {
    return orchestrate(key);
  } else {
    var config = get_config();
    return orchestrate(config.current);
  }
}
exports.get_db = get_db;

function get_config () {
  var config;
  var config_exists = fs.existsSync(CONFIG_PATH);
  if (config_exists) {
    var buffer = fs.readFileSync(CONFIG_PATH);
    var text = buffer.toString();
    var json = ini.parse(text);
    config = json;
  } else {
    config = {
      current: null
    };
  }

  config.keys = config.keys || {};

  return config;
}
exports.get_config = get_config;


function put_config (config) {
  var text = ini.encode(config);
  fs.writeFileSync(CONFIG_PATH, text);
}
exports.put_config = put_config;
